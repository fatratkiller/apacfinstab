<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <link rel="canonical" href="https://apacfinstab.com/tracker/" />
  
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-PX174NJW6M"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-PX174NJW6M');
  </script>
  
  <title>APAC Crypto Policy Tracker & Comparison | Real-time Regulation Database</title>
  <meta name="description" content="Track and compare crypto regulations across Asia-Pacific. Hong Kong vs Singapore vs Japan side-by-side. Filter by protocol, region, topic. Updated daily." />
  <meta name="keywords" content="crypto regulation tracker, APAC crypto policy, Hong Kong vs Singapore crypto, Japan FSA cryptocurrency, crypto regulation comparison, APAC crypto comparison, stablecoin regulation Asia" />
  <meta name="robots" content="index, follow" />
  
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://apacfinstab.com/tracker/" />
  <meta property="og:title" content="APAC Crypto Policy Tracker | APAC FINSTAB" />
  <meta property="og:description" content="Real-time database tracking crypto regulations across Asia-Pacific. Filter by protocol, region, topic, or entity." />
  
  <!-- WebMCP Manifest for AI Agent Integration -->
  <link rel="webmcp-manifest" href="/webmcp.json" />
  
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Dataset",
    "name": "APAC Crypto Policy Tracker",
    "description": "Real-time database tracking cryptocurrency and Web3 regulatory events across Asia-Pacific jurisdictions",
    "url": "https://apacfinstab.com/tracker/",
    "creator": {"@type": "Organization", "name": "APAC FINSTAB"},
    "keywords": ["crypto regulation", "APAC policy", "Ethereum", "Bitcoin", "Solana", "Binance", "OKX", "Hong Kong", "Singapore", "Japan"],
    "spatialCoverage": {"@type": "Place", "name": "Asia-Pacific"},
    "temporalCoverage": "2025/..",
    "isAccessibleForFree": true
  }
  </script>
  
  <style>
    :root {
      --brand-orange: #ff8c42;
      --brand-orange-glow: rgba(255, 140, 66, 0.25);
      --bg-primary: #0a0e1a;
      --bg-card: #1a2035;
      --bg-elevated: #222840;
      --text-primary: #f5f7fa;
      --text-secondary: #a8b2c1;
      --text-muted: #6b7280;
      --border-subtle: rgba(255, 140, 66, 0.08);
      --border-strong: rgba(255, 140, 66, 0.2);
      --accent-green: #10b981;
      --accent-blue: #3b82f6;
      --accent-purple: #8b5cf6;
      --accent-yellow: #f59e0b;
      --accent-red: #ef4444;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(180deg, var(--bg-primary) 0%, #0f1425 100%);
      color: var(--text-primary);
      line-height: 1.6;
      min-height: 100vh;
    }
    
    /* Header */
    header {
      padding: 20px 40px;
      border-bottom: 1px solid var(--border-subtle);
      background: rgba(26, 32, 53, 0.8);
      backdrop-filter: blur(10px);
      position: sticky;
      top: 0;
      z-index: 100;
    }
    .header-inner {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .logo-container { display: flex; align-items: center; gap: 14px; text-decoration: none; }
    .logo-icon { width: 42px; height: 42px; background: linear-gradient(135deg, var(--brand-orange) 0%, #ff6b1a 100%); border-radius: 10px; position: relative; }
    .logo-icon::before { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 20px; height: 20px; border: 2.5px solid #fff; border-radius: 50%; }
    .logo-icon::after { content: ''; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 2.5px; height: 20px; background: #fff; }
    .logo-text .brand { font-weight: 800; font-size: 19px; color: var(--text-primary); display: block; }
    .logo-text .tagline { font-size: 10px; text-transform: uppercase; letter-spacing: 1px; color: var(--brand-orange); font-weight: 700; }
    nav { display: flex; gap: 8px; }
    nav a { padding: 10px 18px; color: var(--text-secondary); text-decoration: none; font-size: 14px; font-weight: 600; border-radius: 8px; }
    nav a:hover { color: var(--brand-orange); background: rgba(255, 140, 66, 0.08); }
    nav a.active { color: var(--brand-orange); background: rgba(255, 140, 66, 0.12); }
    
    /* Hero */
    .hero {
      padding: 60px 40px 40px;
      max-width: 1400px;
      margin: 0 auto;
      text-align: center;
    }
    .hero h1 {
      font-size: 42px;
      font-weight: 900;
      margin-bottom: 16px;
      background: linear-gradient(135deg, #fff 0%, var(--brand-orange) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
    }
    .hero p { font-size: 18px; color: var(--text-secondary); max-width: 700px; margin: 0 auto; }
    .hero-stats {
      display: flex;
      justify-content: center;
      gap: 40px;
      margin-top: 32px;
    }
    .hero-stat { text-align: center; }
    .hero-stat .value { font-size: 32px; font-weight: 900; color: var(--brand-orange); }
    .hero-stat .label { font-size: 12px; color: var(--text-muted); text-transform: uppercase; }
    
    /* Filters */
    .filters {
      padding: 24px 40px;
      max-width: 1400px;
      margin: 0 auto;
      background: var(--bg-card);
      border-radius: 16px;
      margin-bottom: 32px;
    }
    .filter-section {
      margin-bottom: 16px;
    }
    .filter-section:last-child { margin-bottom: 0; }
    .filter-label {
      font-size: 11px;
      font-weight: 700;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 8px;
      display: block;
    }
    .filter-buttons {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }
    .filter-btn {
      padding: 8px 14px;
      background: var(--bg-elevated);
      border: 1px solid var(--border-subtle);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
    }
    .filter-btn:hover {
      border-color: var(--brand-orange);
      color: var(--brand-orange);
    }
    .filter-btn.active {
      background: rgba(255, 140, 66, 0.15);
      border-color: var(--brand-orange);
      color: var(--brand-orange);
    }
    .filter-btn .emoji { margin-right: 4px; }
    
    /* Results */
    .results {
      padding: 0 40px 80px;
      max-width: 1400px;
      margin: 0 auto;
    }
    .results-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    .results-count { font-size: 14px; color: var(--text-muted); }
    .results-count strong { color: var(--text-primary); }
    
    /* Timeline */
    .timeline { position: relative; }
    .year-group { margin-bottom: 40px; }
    .year-label {
      font-size: 24px;
      font-weight: 900;
      color: var(--brand-orange);
      margin-bottom: 16px;
      padding-bottom: 8px;
      border-bottom: 2px solid var(--brand-orange);
      display: inline-block;
    }
    
    .event-card {
      background: var(--bg-card);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 20px 24px;
      margin-bottom: 12px;
      transition: all 0.2s;
      cursor: pointer;
    }
    .event-card:hover {
      border-color: var(--brand-orange);
      transform: translateX(4px);
    }
    .event-card.high { border-left: 4px solid var(--accent-green); }
    .event-card.medium { border-left: 4px solid var(--accent-yellow); }
    .event-card.low { border-left: 4px solid var(--text-muted); }
    
    .event-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 10px;
    }
    .event-date {
      font-size: 13px;
      font-weight: 700;
      color: var(--brand-orange);
      white-space: nowrap;
    }
    .event-tags { display: flex; flex-wrap: wrap; gap: 6px; }
    .tag {
      padding: 3px 8px;
      border-radius: 6px;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
    }
    .tag.protocol { background: rgba(139, 92, 246, 0.15); color: var(--accent-purple); }
    .tag.region { background: rgba(59, 130, 246, 0.15); color: var(--accent-blue); }
    .tag.topic { background: rgba(16, 185, 129, 0.15); color: var(--accent-green); }
    .tag.entity { background: rgba(245, 158, 11, 0.15); color: var(--accent-yellow); }
    
    .event-title {
      font-size: 17px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      line-height: 1.4;
    }
    .event-summary {
      font-size: 14px;
      color: var(--text-secondary);
      line-height: 1.6;
    }
    .event-source {
      margin-top: 10px;
      font-size: 12px;
    }
    .event-source a {
      color: var(--text-muted);
      text-decoration: none;
    }
    .event-source a:hover { color: var(--brand-orange); }
    
    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }
    .empty-state .icon { font-size: 48px; margin-bottom: 16px; }
    
    /* Loading */
    .loading {
      text-align: center;
      padding: 60px;
      color: var(--text-muted);
    }
    
    /* Footer */
    footer {
      padding: 40px;
      border-top: 1px solid var(--border-subtle);
      text-align: center;
    }
    .footer-logo { font-size: 18px; font-weight: 800; color: var(--brand-orange); margin-bottom: 12px; }
    .footer-text { font-size: 13px; color: var(--text-muted); }
    
    /* Tabs */
    .tab-bar {
      display: flex;
      justify-content: center;
      gap: 8px;
      padding: 0 40px;
      margin-bottom: 24px;
    }
    .tab-btn {
      padding: 12px 32px;
      background: var(--bg-card);
      border: 2px solid var(--border-strong);
      border-radius: 10px;
      color: var(--text-secondary);
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s;
    }
    .tab-btn:hover {
      border-color: var(--brand-orange);
      color: var(--text-primary);
    }
    .tab-btn.active {
      background: rgba(255, 140, 66, 0.15);
      border-color: var(--brand-orange);
      color: var(--brand-orange);
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    
    /* Compare View */
    .compare-selector {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 12px;
      padding: 0 40px;
      margin-bottom: 16px;
    }
    .jurisdiction-btn {
      padding: 10px 20px;
      background: var(--bg-card);
      border: 2px solid var(--border-strong);
      border-radius: 8px;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 6px;
    }
    .jurisdiction-btn:hover { border-color: var(--brand-orange); color: var(--text-primary); }
    .jurisdiction-btn.selected { background: rgba(255, 140, 66, 0.15); border-color: var(--brand-orange); color: var(--brand-orange); }
    .compare-instruction { text-align: center; color: var(--text-muted); font-size: 13px; margin-bottom: 24px; }
    
    .comparison-grid { max-width: 1400px; margin: 0 auto; padding: 0 40px 60px; display: grid; gap: 16px; }
    .comparison-row { display: grid; gap: 12px; align-items: stretch; }
    .comparison-row.cols-2 { grid-template-columns: 180px repeat(2, 1fr); }
    .comparison-row.cols-3 { grid-template-columns: 180px repeat(3, 1fr); }
    .comparison-row.cols-4 { grid-template-columns: 180px repeat(4, 1fr); }
    .row-label { background: var(--bg-elevated); padding: 14px; border-radius: 8px; font-weight: 700; font-size: 13px; display: flex; align-items: center; color: var(--brand-orange); }
    .comparison-cell { background: var(--bg-card); padding: 14px; border-radius: 8px; border: 1px solid var(--border-subtle); font-size: 13px; }
    .comparison-cell.header { background: var(--bg-elevated); text-align: center; font-weight: 700; border: 2px solid var(--border-strong); }
    .comparison-cell .flag { font-size: 20px; display: block; margin-bottom: 4px; }
    .comparison-cell .value { color: var(--text-secondary); }
    .status-badge { display: inline-block; padding: 3px 8px; border-radius: 5px; font-size: 11px; font-weight: 600; }
    .status-badge.green { background: rgba(16, 185, 129, 0.2); color: var(--accent-green); }
    .status-badge.yellow { background: rgba(245, 158, 11, 0.2); color: var(--accent-yellow); }
    .status-badge.red { background: rgba(239, 68, 68, 0.2); color: var(--accent-red); }
    .status-badge.blue { background: rgba(59, 130, 246, 0.2); color: var(--accent-blue); }
    .compare-empty { text-align: center; padding: 60px 20px; color: var(--text-muted); }
    .compare-empty .icon { font-size: 40px; margin-bottom: 12px; }
    
    @media (max-width: 900px) {
      .comparison-row, .comparison-row.cols-2, .comparison-row.cols-3, .comparison-row.cols-4 { grid-template-columns: 1fr; }
      .row-label { background: var(--brand-orange); color: #fff; }
    }
    
    /* CTA */
    .cta-bar {
      padding: 20px 40px;
      max-width: 1400px;
      margin: 0 auto 32px;
    }
    .cta-inner {
      padding: 24px 32px;
      background: linear-gradient(135deg, rgba(255, 140, 66, 0.1) 0%, rgba(255, 140, 66, 0.05) 100%);
      border: 1px solid var(--brand-orange);
      border-radius: 12px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 20px;
      flex-wrap: wrap;
    }
    .cta-text h3 { font-size: 18px; font-weight: 700; margin-bottom: 4px; }
    .cta-text p { font-size: 14px; color: var(--text-secondary); }
    .cta-btn {
      padding: 12px 24px;
      background: var(--brand-orange);
      color: #fff;
      border-radius: 8px;
      text-decoration: none;
      font-weight: 700;
      font-size: 14px;
      white-space: nowrap;
    }
    
    @media (max-width: 768px) {
      header { padding: 16px 20px; }
      .hero, .filters, .results, .cta-bar { padding-left: 20px; padding-right: 20px; }
      .hero h1 { font-size: 28px; }
      .hero-stats { gap: 24px; }
      .cta-inner { flex-direction: column; text-align: center; }
      nav { display: none; }
    }
  </style>
</head>
<body>

<header>
  <div class="header-inner">
    <a href="/" class="logo-container">
      <div class="logo-icon"></div>
      <div class="logo-text">
        <span class="brand">APAC FINSTAB</span>
        <span class="tagline">Regulatory Intelligence</span>
      </div>
    </a>
    <nav>
      <a href="/">Dashboard</a>
      <a href="/tracker/" class="active">Policy Tracker</a>
      <a href="/ren/">REN</a>
      <a href="/learn/">Learn</a>
      <a href="/blog.html">Insights</a>
      <a href="/contact.html">Contact</a>
    </nav>
  </div>
</header>

<main>
<section class="hero">
  <h1>üîç APAC Crypto Policy Tracker</h1>
  <p>Real-time regulatory intelligence database. Filter by protocol, region, topic, or entity. Updated daily.</p>
  <div class="hero-stats">
    <div class="hero-stat">
      <div class="value" id="stat-events">--</div>
      <div class="label">Policy Events</div>
    </div>
    <div class="hero-stat">
      <div class="value" id="stat-regions">--</div>
      <div class="label">Regions</div>
    </div>
    <div class="hero-stat">
      <div class="value" id="stat-protocols">--</div>
      <div class="label">Protocols</div>
    </div>
  </div>
</section>

<div class="tab-bar">
  <button class="tab-btn active" onclick="switchTab('events')">üìã Policy Events</button>
  <button class="tab-btn" onclick="switchTab('compare')">‚öñÔ∏è Compare Jurisdictions</button>
</div>

<div id="events-view" class="tab-content active">
<!-- WebMCP Declarative Form for AI Agents -->
<form id="webmcp-policy-search" data-webmcp-tool="getLatestPolicies" data-webmcp-description="Search APAC crypto policy events by region, topic, and time range" style="display:none;">
  <select name="region" data-webmcp-param="region" data-webmcp-description="APAC region code">
    <option value="">All Regions</option>
    <option value="HK">Hong Kong</option>
    <option value="SG">Singapore</option>
    <option value="JP">Japan</option>
    <option value="KR">South Korea</option>
    <option value="AU">Australia</option>
    <option value="CN">China</option>
    <option value="IN">India</option>
    <option value="TH">Thailand</option>
    <option value="ID">Indonesia</option>
  </select>
  <select name="topic" data-webmcp-param="topic" data-webmcp-description="Policy topic filter">
    <option value="">All Topics</option>
    <option value="Stablecoin">Stablecoin</option>
    <option value="Exchange">Exchange</option>
    <option value="DeFi">DeFi</option>
    <option value="ETF">ETF</option>
    <option value="Licensing">Licensing</option>
    <option value="CBDC">CBDC</option>
    <option value="Taxation">Taxation</option>
  </select>
  <input type="number" name="days" value="30" data-webmcp-param="days" data-webmcp-description="Events from last N days" />
</form>

<section class="filters" id="filters">
  <div class="filter-section">
    <span class="filter-label">Protocol</span>
    <div class="filter-buttons" id="filter-protocols"></div>
  </div>
  <div class="filter-section">
    <span class="filter-label">Region</span>
    <div class="filter-buttons" id="filter-regions"></div>
  </div>
  <div class="filter-section">
    <span class="filter-label">Topic</span>
    <div class="filter-buttons" id="filter-topics"></div>
  </div>
  <div class="filter-section">
    <span class="filter-label">Entity</span>
    <div class="filter-buttons" id="filter-entities"></div>
  </div>
</section>

<section class="cta-bar">
  <div class="cta-inner">
    <div class="cta-text">
      <h3>Need Custom Policy Tracking?</h3>
      <p>We provide tailored regulatory intelligence for L1/L2 protocols and exchanges expanding into APAC.</p>
    </div>
    <a href="/contact.html" class="cta-btn">Get in Touch ‚Üí</a>
  </div>
</section>

<section class="results">
  <div class="results-header">
    <div class="results-count">Showing <strong id="results-count">0</strong> events</div>
  </div>
  <div class="timeline" id="timeline">
    <div class="loading">Loading policy events...</div>
  </div>
</section>
</div>

<div id="compare-view" class="tab-content">
  <div class="compare-selector" id="compare-selector">
    <button class="jurisdiction-btn" data-code="HK" onclick="toggleCompare('HK')">üá≠üá∞ Hong Kong</button>
    <button class="jurisdiction-btn" data-code="SG" onclick="toggleCompare('SG')">üá∏üá¨ Singapore</button>
    <button class="jurisdiction-btn" data-code="JP" onclick="toggleCompare('JP')">üáØüáµ Japan</button>
    <button class="jurisdiction-btn" data-code="KR" onclick="toggleCompare('KR')">üá∞üá∑ South Korea</button>
    <button class="jurisdiction-btn" data-code="AU" onclick="toggleCompare('AU')">üá¶üá∫ Australia</button>
    <button class="jurisdiction-btn" data-code="ID" onclick="toggleCompare('ID')">üáÆüá© Indonesia</button>
  </div>
  <p class="compare-instruction">Select 2-4 jurisdictions to compare</p>
  <div id="compare-output">
    <div class="compare-empty"><div class="icon">‚öñÔ∏è</div><p>Select jurisdictions above</p></div>
  </div>
</div>
</main>

<footer>
  <div class="footer-logo">APAC FINSTAB+</div>
  <p class="footer-text">
    APAC Crypto Policy Tracker ‚Äî Updated Daily<br/>
    ¬© 2026 APAC FINSTAB. All rights reserved.
  </p>
</footer>

<script>
// ==========================================
// WebMCP Imperative API Registration
// For AI Agent direct tool invocation
// ==========================================
if (typeof window.webmcp !== 'undefined') {
  // Tool: getLatestPolicies
  window.webmcp.registerTool('getLatestPolicies', {
    description: 'Get latest crypto policy events from APAC regions',
    parameters: {
      region: { type: 'string', description: 'Region code (HK, SG, JP, KR, AU, CN, IN, TH, ID)' },
      topic: { type: 'string', description: 'Topic filter (Stablecoin, Exchange, DeFi, ETF, Licensing)' },
      days: { type: 'number', description: 'Events from last N days', default: 30 }
    },
    async execute(params) {
      const res = await fetch('/data/policy-events.json');
      const data = await res.json();
      let events = data.events;
      
      if (params.region) {
        events = events.filter(e => e.regions.includes(params.region));
      }
      if (params.topic) {
        events = events.filter(e => e.topics.includes(params.topic));
      }
      if (params.days) {
        const cutoff = new Date();
        cutoff.setDate(cutoff.getDate() - params.days);
        events = events.filter(e => new Date(e.date) >= cutoff);
      }
      
      return events.map(e => ({
        id: e.id,
        date: e.date,
        title: e.title,
        regions: e.regions,
        topics: e.topics,
        summary: e.summary,
        impact: e.impact || 'medium'
      }));
    }
  });

  // Tool: getRegionOverview
  window.webmcp.registerTool('getRegionOverview', {
    description: 'Get regulatory overview for a specific APAC region',
    parameters: {
      region: { type: 'string', required: true, description: 'Region code (HK, SG, JP, KR, AU, CN)' }
    },
    async execute(params) {
      const res = await fetch('/data/region-overviews.json');
      const data = await res.json();
      return data.regions[params.region] || { error: 'Region not found' };
    }
  });

  // Tool: comparePolicies
  window.webmcp.registerTool('comparePolicies', {
    description: 'Compare crypto policies across multiple APAC regions',
    parameters: {
      regions: { type: 'array', description: 'Array of region codes to compare' },
      topic: { type: 'string', description: 'Topic to compare (Stablecoin, Exchange, Licensing)' }
    },
    async execute(params) {
      const res = await fetch('/data/region-overviews.json');
      const data = await res.json();
      
      const comparison = params.regions.map(r => {
        const region = data.regions[r];
        if (!region) return { region: r, error: 'Not found' };
        
        return {
          region: r,
          name: region.name,
          regulator: region.regulator,
          framework: region.framework,
          exchangeLicensing: region.exchangeLicensing,
          stablecoinRules: region.stablecoinRules,
          status: region.status
        };
      });
      
      return { topic: params.topic || 'General', comparison };
    }
  });

  console.log('[WebMCP] APAC FINSTAB tools registered: getLatestPolicies, getRegionOverview, comparePolicies');
}

// ==========================================
// Main Application Code
// ==========================================
const regionEmojis = {
  HK: 'üá≠üá∞', SG: 'üá∏üá¨', JP: 'üáØüáµ', KR: 'üá∞üá∑', CN: 'üá®üá≥',
  AU: 'üá¶üá∫', IN: 'üáÆüá≥', TH: 'üáπüá≠', ID: 'üáÆüá©', VN: 'üáªüá≥',
  PH: 'üáµüá≠', MY: 'üá≤üáæ', TW: 'üáπüáº', US: 'üá∫üá∏', BR: 'üáßüá∑',
  RU: 'üá∑üá∫', UK: 'üá¨üáß', PK: 'üáµüá∞'
};

let data = null;
let activeFilters = { protocols: [], regions: [], topics: [], entities: [] };

async function loadData() {
  try {
    const res = await fetch('/data/policy-events.json');
    data = await res.json();
    initFilters();
    renderEvents();
    updateStats();
  } catch (e) {
    document.getElementById('timeline').innerHTML = '<div class="empty-state"><div class="icon">‚ö†Ô∏è</div><p>Failed to load data</p></div>';
  }
}

function initFilters() {
  const dims = data.dimensions;
  
  // Protocols
  document.getElementById('filter-protocols').innerHTML = dims.protocols.map(p => 
    `<button class="filter-btn" data-type="protocols" data-value="${p}">${p}</button>`
  ).join('');
  
  // Regions
  document.getElementById('filter-regions').innerHTML = dims.regions.map(r => 
    `<button class="filter-btn" data-type="regions" data-value="${r}"><span class="emoji">${regionEmojis[r] || ''}</span>${r}</button>`
  ).join('');
  
  // Topics
  document.getElementById('filter-topics').innerHTML = dims.topics.map(t => 
    `<button class="filter-btn" data-type="topics" data-value="${t}">${t}</button>`
  ).join('');
  
  // Entities
  document.getElementById('filter-entities').innerHTML = dims.entities.map(e => 
    `<button class="filter-btn" data-type="entities" data-value="${e}">${e}</button>`
  ).join('');
  
  // Add click handlers
  document.querySelectorAll('.filter-btn').forEach(btn => {
    btn.addEventListener('click', () => toggleFilter(btn));
  });
}

function toggleFilter(btn) {
  const type = btn.dataset.type;
  const value = btn.dataset.value;
  
  if (activeFilters[type].includes(value)) {
    activeFilters[type] = activeFilters[type].filter(v => v !== value);
    btn.classList.remove('active');
  } else {
    activeFilters[type].push(value);
    btn.classList.add('active');
  }
  
  renderEvents();
}

function filterEvents() {
  return data.events.filter(evt => {
    if (activeFilters.protocols.length && !activeFilters.protocols.some(p => evt.protocols.includes(p))) return false;
    if (activeFilters.regions.length && !activeFilters.regions.some(r => evt.regions.includes(r))) return false;
    if (activeFilters.topics.length && !activeFilters.topics.some(t => evt.topics.includes(t))) return false;
    if (activeFilters.entities.length && !activeFilters.entities.some(e => evt.entities.includes(e))) return false;
    return true;
  });
}

function renderEvents() {
  const events = filterEvents();
  document.getElementById('results-count').textContent = events.length;
  
  if (!events.length) {
    document.getElementById('timeline').innerHTML = '<div class="empty-state"><div class="icon">üîç</div><p>No events match your filters</p></div>';
    return;
  }
  
  // Group by year
  const byYear = {};
  events.forEach(evt => {
    const year = evt.date.split('-')[0];
    if (!byYear[year]) byYear[year] = [];
    byYear[year].push(evt);
  });
  
  let html = '';
  Object.keys(byYear).sort().reverse().forEach(year => {
    html += `<div class="year-group"><div class="year-label">${year}</div>`;
    byYear[year].sort((a, b) => b.date.localeCompare(a.date)).forEach(evt => {
      html += renderEventCard(evt);
    });
    html += '</div>';
  });
  
  document.getElementById('timeline').innerHTML = html;
}

function renderEventCard(evt) {
  const date = new Date(evt.date).toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
  
  let tags = '';
  evt.protocols.forEach(p => tags += `<span class="tag protocol">${p}</span>`);
  evt.regions.forEach(r => tags += `<span class="tag region">${regionEmojis[r] || ''} ${r}</span>`);
  evt.topics.slice(0, 2).forEach(t => tags += `<span class="tag topic">${t}</span>`);
  evt.entities.forEach(e => tags += `<span class="tag entity">${e}</span>`);
  
  return `
    <div class="event-card ${evt.impact || 'medium'}">
      <div class="event-header">
        <span class="event-date">${date}</span>
        <div class="event-tags">${tags}</div>
      </div>
      <h3 class="event-title">${evt.title}</h3>
      <p class="event-summary">${evt.summary}</p>
      ${evt.source ? `<div class="event-source"><a href="${evt.source}" target="_blank">Source ‚Üí</a></div>` : ''}
    </div>
  `;
}

function updateStats() {
  const events = data.events;
  const regions = new Set();
  const protocols = new Set();
  
  events.forEach(e => {
    e.regions.forEach(r => regions.add(r));
    e.protocols.forEach(p => protocols.add(p));
  });
  
  document.getElementById('stat-events').textContent = events.length;
  document.getElementById('stat-regions').textContent = regions.size;
  document.getElementById('stat-protocols').textContent = protocols.size;
}

loadData();

// Tab switching
function switchTab(tab) {
  document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
  document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
  document.querySelector(`.tab-btn[onclick*="${tab}"]`).classList.add('active');
  document.getElementById(tab + '-view').classList.add('active');
}

// Compare functionality
const jurisdictionData = {
  HK: { name: 'Hong Kong', flag: 'üá≠üá∞', regulator: 'SFC / HKMA',
    license: { name: 'VASP License', status: 'Mandatory', statusClass: 'green', detail: 'Full enforcement since June 2025' },
    stablecoin: { status: 'Licensing Q1 2026', statusClass: 'yellow', detail: 'First licenses March 2026' },
    staking: { status: 'Permitted', statusClass: 'green', detail: 'ETF launched Jan 2026' },
    defi: { status: 'Sandbox planned', statusClass: 'yellow' },
    retail: { status: 'Full access', statusClass: 'green' },
    score: 8.5, trend: 'Expanding', trendClass: 'green' },
  SG: { name: 'Singapore', flag: 'üá∏üá¨', regulator: 'MAS',
    license: { name: 'MPI License', status: 'Mandatory', statusClass: 'green', detail: 'Enforced since 2020' },
    stablecoin: { status: 'Framework active', statusClass: 'green', detail: 'MAS framework Aug 2023' },
    staking: { status: 'Guidelines issued', statusClass: 'green', detail: 'Nov 2025 guidelines' },
    defi: { status: 'Project Guardian', statusClass: 'green' },
    retail: { status: 'Restricted', statusClass: 'yellow' },
    score: 8.0, trend: 'Stable', trendClass: 'blue' },
  JP: { name: 'Japan', flag: 'üáØüáµ', regulator: 'FSA / JFSA',
    license: { name: 'CESRB Registration', status: 'Mandatory', statusClass: 'green', detail: 'Since 2017, updated 2023' },
    stablecoin: { status: 'Trust-based only', statusClass: 'yellow', detail: 'Bank-grade reserves' },
    staking: { status: 'FIA migration', statusClass: 'yellow', detail: 'Q2 2026 transition' },
    defi: { status: 'Uncertain', statusClass: 'yellow' },
    retail: { status: 'Full access', statusClass: 'green' },
    score: 7.5, trend: 'Reforming', trendClass: 'yellow' },
  KR: { name: 'South Korea', flag: 'üá∞üá∑', regulator: 'FSC / FSS',
    license: { name: 'VASP Registration', status: 'Mandatory', statusClass: 'green', detail: 'VAUPA effective Sep 2025' },
    stablecoin: { status: 'Restricted', statusClass: 'red', detail: 'KRW stablecoins banned' },
    staking: { status: 'Under review', statusClass: 'yellow', detail: 'Post-Bithumb review' },
    defi: { status: 'Not addressed', statusClass: 'red' },
    retail: { status: 'Full access', statusClass: 'green' },
    score: 6.5, trend: 'Tightening', trendClass: 'red' },
  AU: { name: 'Australia', flag: 'üá¶üá∫', regulator: 'ASIC / AUSTRAC',
    license: { name: 'AFSL (pending)', status: 'Grace period', statusClass: 'yellow', detail: 'Deadline June 30, 2026' },
    stablecoin: { status: 'Consultation', statusClass: 'yellow', detail: 'Treasury ongoing' },
    staking: { status: 'Unclear', statusClass: 'yellow', detail: 'May require AFSL' },
    defi: { status: 'Unregulated', statusClass: 'yellow' },
    retail: { status: 'Full access', statusClass: 'green' },
    score: 6.0, trend: 'Developing', trendClass: 'yellow' },
  ID: { name: 'Indonesia', flag: 'üáÆüá©', regulator: 'OJK / Bappebti',
    license: { name: 'Bappebti Reg', status: 'Mandatory', statusClass: 'green', detail: 'Transition to OJK' },
    stablecoin: { status: 'Not permitted', statusClass: 'red', detail: 'Commodity-only' },
    staking: { status: 'Not addressed', statusClass: 'red', detail: 'No framework' },
    defi: { status: 'Not permitted', statusClass: 'red' },
    retail: { status: 'Restricted', statusClass: 'yellow' },
    score: 4.5, trend: 'Restrictive', trendClass: 'red' }
};

let selectedJurisdictions = [];

function toggleCompare(code) {
  const btn = document.querySelector(`.jurisdiction-btn[data-code="${code}"]`);
  const idx = selectedJurisdictions.indexOf(code);
  if (idx > -1) { selectedJurisdictions.splice(idx, 1); btn.classList.remove('selected'); }
  else if (selectedJurisdictions.length < 4) { selectedJurisdictions.push(code); btn.classList.add('selected'); }
  renderComparison();
}

function renderComparison() {
  const output = document.getElementById('compare-output');
  if (selectedJurisdictions.length < 2) {
    output.innerHTML = '<div class="compare-empty"><div class="icon">‚öñÔ∏è</div><p>Select at least 2 jurisdictions</p></div>';
    return;
  }
  const cols = selectedJurisdictions.length;
  const colClass = `cols-${cols}`;
  let html = '<div class="comparison-grid">';
  
  // Header
  html += `<div class="comparison-row ${colClass}"><div class="row-label">Jurisdiction</div>`;
  selectedJurisdictions.forEach(c => {
    const j = jurisdictionData[c];
    html += `<div class="comparison-cell header"><span class="flag">${j.flag}</span>${j.name}<br><span class="status-badge ${j.trendClass}">${j.trend}</span></div>`;
  });
  html += '</div>';
  
  // Rows
  const rows = [
    { label: 'Regulator', key: 'regulator', simple: true },
    { label: 'Exchange License', key: 'license' },
    { label: 'Stablecoin', key: 'stablecoin' },
    { label: 'Staking', key: 'staking' },
    { label: 'DeFi', key: 'defi' },
    { label: 'Retail Access', key: 'retail' }
  ];
  
  rows.forEach(row => {
    html += `<div class="comparison-row ${colClass}"><div class="row-label">${row.label}</div>`;
    selectedJurisdictions.forEach(c => {
      const j = jurisdictionData[c];
      if (row.simple) {
        html += `<div class="comparison-cell"><div class="value">${j[row.key]}</div></div>`;
      } else {
        const d = j[row.key];
        html += `<div class="comparison-cell"><span class="status-badge ${d.statusClass}">${d.status}</span><div class="value" style="margin-top:6px">${d.detail || ''}</div></div>`;
      }
    });
    html += '</div>';
  });
  
  // Score
  html += `<div class="comparison-row ${colClass}"><div class="row-label">Maturity Score</div>`;
  selectedJurisdictions.forEach(c => {
    const j = jurisdictionData[c];
    const color = j.score >= 7.5 ? 'var(--accent-green)' : (j.score >= 6 ? 'var(--accent-yellow)' : 'var(--accent-red)');
    html += `<div class="comparison-cell" style="text-align:center"><div style="font-size:28px;font-weight:800;color:${color}">${j.score}</div><div class="value">/10</div></div>`;
  });
  html += '</div></div>';
  
  output.innerHTML = html;
}
</script>

</body>
</html>
