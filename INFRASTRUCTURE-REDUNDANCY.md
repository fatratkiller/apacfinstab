# 基础设施冗余方案 - 去中心化架构

> 2026-03-01 GitHub事件后制定
> 原则：任何单点故障不应影响业务运行

## 🎯 目标
- GitHub挂了 → 网站继续运行
- GitHub + GitLab都挂了 → 还有本地备份
- 代码托管 ≠ 网站托管（解耦）

## 📐 新架构

```
┌─────────────────────────────────────────────────────────┐
│                     代码存储层                           │
├─────────────┬─────────────┬─────────────────────────────┤
│   GitHub    │   GitLab    │   本地 (Mac + NAS)          │
│   (主)      │   (镜像)    │   (备份)                    │
└─────────────┴─────────────┴─────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────────────┐
│                     网站托管层                           │
├─────────────────────────────────────────────────────────┤
│              Cloudflare Pages (主)                       │
│              ← 从GitLab自动部署                          │
├─────────────────────────────────────────────────────────┤
│              Vercel / Netlify (备)                       │
│              ← 手动部署备用                              │
└─────────────────────────────────────────────────────────┘
                      ↓
┌─────────────────────────────────────────────────────────┐
│                     域名/DNS层                           │
├─────────────────────────────────────────────────────────┤
│              Cloudflare DNS                              │
│              apacfinstab.com → Cloudflare Pages          │
└─────────────────────────────────────────────────────────┘
```

## 🔄 日常工作流

```bash
# 开发时：推送到两个仓库
git push origin main      # → GitHub (代码备份)
git push gitlab main      # → GitLab → Cloudflare Pages (自动部署)
```

## 🚨 故障切换流程

### 场景1: GitHub不可用
- 无影响：网站从Cloudflare Pages运行
- 代码继续推送到GitLab
- 等GitHub恢复后同步

### 场景2: Cloudflare Pages不可用
- 切换DNS到Vercel/Netlify备用
- 手动部署到备用平台
- 5分钟内恢复

### 场景3: GitLab不可用
- 临时切换到GitHub Pages
- 或手动上传到Cloudflare Pages

## 📋 迁移实施清单

### 阶段1: 立即执行 (今天)
- [ ] 邮箱注册GitLab账号
- [ ] 创建apacfinstab仓库
- [ ] 本地添加gitlab remote
- [ ] 推送代码到GitLab

### 阶段2: Cloudflare配置 (今天)
- [ ] Cloudflare Pages连接GitLab
- [ ] 配置自动部署
- [ ] 设置apacfinstab.com域名
- [ ] 验证网站正常

### 阶段3: 自动化配置 (本周)
- [ ] 修改所有cron任务：push到两个仓库
- [ ] 设置git alias简化操作
- [ ] 编写备份脚本

### 阶段4: 监控告警 (本周)
- [ ] 设置网站可用性监控
- [ ] 配置故障告警
- [ ] 定期验证备用方案

## 💰 成本
| 服务 | 费用 |
|------|------|
| GitLab | 免费 |
| Cloudflare Pages | 免费 |
| Vercel (备用) | 免费 |
| 总计 | **$0/月** |

---

*核心原则：不把鸡蛋放在一个篮子里*
